# 测试计划

## 测试目标

确保博客系统在生产环境中所有功能正常运行，包括用户管理、文章管理、评论系统、搜索功能等。

## 测试环境

### 环境配置
- **前端**：Cloudflare Pages
- **后端**：Cloudflare Workers
- **数据库**：Cloudflare D1
- **存储**：Cloudflare R2

## 测试清单

### 1. 用户认证测试

#### 1.1 用户注册
- [ ] 使用有效邮箱注册新账户
- [ ] 密码长度验证（至少6个字符）
- [ ] 邮箱格式验证
- [ ] 用户名唯一性验证
- [ ] 重复邮箱注册应失败
- [ ] 注册成功后跳转到登录页

**测试步骤**：
```
1. 访问 /register
2. 填写：
   - 邮箱：test@example.com
   - 用户名：testuser
   - 显示名称：Test User
   - 密码：test123456
   - 确认密码：test123456
3. 点击"注册"
4. 验证成功消息
5. 尝试用相同邮箱再次注册（应失败）
```

**预期结果**：
- 注册成功，显示成功消息
- 重复注册失败，显示错误提示

#### 1.2 用户登录
- [ ] 使用正确的邮箱密码登录
- [ ] 错误的密码应登录失败
- [ ] 不存在的邮箱应登录失败
- [ ] 登录成功后显示用户信息
- [ ] 会话保持（刷新页面仍保持登录）

**测试步骤**：
```
1. 访问 /login
2. 输入注册的邮箱和密码
3. 点击"登录"
4. 验证跳转到首页
5. 验证右上角显示用户名
6. 刷新页面，验证仍然登录
```

**预期结果**：
- 登录成功，跳转首页
- 显示用户菜单
- 刷新后仍保持登录状态

#### 1.3 用户登出
- [ ] 点击登出按钮
- [ ] 会话清除
- [ ] 跳转到首页（游客状态）

**测试步骤**：
```
1. 点击用户菜单 > 退出登录
2. 验证跳转到首页
3. 验证显示"登录"和"注册"按钮
```

**预期结果**：
- 成功登出
- 返回游客状态

### 2. 文章管理测试

#### 2.1 创建文章
- [ ] 点击"写文章"按钮
- [ ] 填写标题、内容
- [ ] 选择分类和标签
- [ ] 添加封面图片（可选）
- [ ] 保存为草稿
- [ ] 发布文章

**测试步骤**：
```
1. 登录后点击"写文章"
2. 填写：
   - 标题：测试文章标题
   - 内容：# 这是测试内容\n\n使用 **Markdown** 格式
   - 摘要：这是文章摘要
   - 选择分类：技术
   - 选择标签：JavaScript, React
3. 点击"保存"（草稿）
4. 再次编辑，改为"已发布"状态
5. 保存
```

**预期结果**：
- 文章创建成功
- 草稿状态正确
- 发布后在首页显示

#### 2.2 编辑文章
- [ ] 在个人中心找到已发布的文章
- [ ] 点击"编辑"
- [ ] 修改标题和内容
- [ ] 保存更改

**测试步骤**：
```
1. 访问 /profile
2. 找到之前创建的文章
3. 点击"编辑"
4. 修改标题：测试文章标题（已编辑）
5. 保存
6. 返回文章详情页验证更改
```

**预期结果**：
- 编辑成功
- 更改立即生效

#### 2.3 删除文章
- [ ] 在文章详情页点击"删除"
- [ ] 确认删除对话框
- [ ] 文章被删除，跳转首页

**测试步骤**：
```
1. 访问文章详情页
2. 点击"删除"按钮
3. 确认删除
4. 验证跳转到首页
5. 验证文章不再显示
```

**预期结果**：
- 文章成功删除
- 数据库中记录被移除

#### 2.4 Markdown 渲染
- [ ] 标题（H1-H6）
- [ ] 粗体、斜体
- [ ] 列表（有序、无序）
- [ ] 代码块（带语法高亮）
- [ ] 链接
- [ ] 图片
- [ ] 引用块
- [ ] 表格

**测试内容**：
```markdown
# 一级标题
## 二级标题

**粗体** *斜体* `代码`

- 列表项 1
- 列表项 2

1. 有序列表 1
2. 有序列表 2

```javascript
console.log('Hello World');
```

[链接](https://example.com)

> 引用文本

| 表头1 | 表头2 |
|------|------|
| 内容1 | 内容2 |
```

**预期结果**：
- 所有 Markdown 语法正确渲染
- 代码块有语法高亮

### 3. 评论系统测试

#### 3.1 发表评论
- [ ] 在文章详情页底部找到评论区
- [ ] 填写评论内容
- [ ] 提交评论
- [ ] 评论立即显示

**测试步骤**：
```
1. 访问任意文章详情页
2. 滚动到评论区
3. 输入评论：这是一条测试评论
4. 点击"发表评论"
5. 验证评论出现在列表中
```

**预期结果**：
- 评论成功发表
- 显示用户名、头像、时间

#### 3.2 删除评论
- [ ] 点击自己评论的删除按钮
- [ ] 确认删除
- [ ] 评论被移除

**测试步骤**：
```
1. 找到自己发表的评论
2. 点击删除按钮（垃圾桶图标）
3. 确认删除
4. 验证评论消失
```

**预期结果**：
- 评论成功删除
- 其他用户的评论不能删除

### 4. 搜索功能测试

#### 4.1 全文搜索
- [ ] 在顶部搜索框输入关键词
- [ ] 搜索结果正确显示
- [ ] 标题匹配
- [ ] 内容匹配

**测试步骤**：
```
1. 在顶部搜索框输入："测试"
2. 按 Enter 或点击搜索
3. 验证包含"测试"的文章出现
4. 尝试搜索文章内容中的关键词
```

**预期结果**：
- 搜索结果准确
- 高亮显示匹配内容

#### 4.2 分类筛选
- [ ] 点击侧边栏的分类
- [ ] 只显示该分类的文章
- [ ] 点击"全部"恢复所有文章

**测试步骤**：
```
1. 在首页侧边栏点击"技术"分类
2. 验证只显示技术类文章
3. 点击"全部"
4. 验证显示所有文章
```

**预期结果**：
- 分类筛选正确
- URL 参数正确（?category=tech）

#### 4.3 标签筛选
- [ ] 点击标签
- [ ] 只显示包含该标签的文章

**测试步骤**：
```
1. 点击任意标签（如"React"）
2. 验证只显示带该标签的文章
```

**预期结果**：
- 标签筛选正确

### 5. UI/UX 测试

#### 5.1 响应式设计
- [ ] 桌面端（1920x1080）
- [ ] 平板端（768x1024）
- [ ] 手机端（375x667）
- [ ] 导航菜单适配
- [ ] 文章列表布局适配

**测试步骤**：
```
1. 使用浏览器开发者工具
2. 切换不同设备尺寸
3. 验证布局正常
4. 验证导航菜单在移动端可用
```

**预期结果**：
- 所有尺寸下布局正常
- 文字可读，按钮可点击

#### 5.2 深色模式
- [ ] 点击主题切换按钮
- [ ] 切换到深色模式
- [ ] 所有元素颜色正确
- [ ] 刷新后保持主题

**测试步骤**：
```
1. 点击顶部月亮/太阳图标
2. 验证切换到深色模式
3. 检查所有页面元素
4. 刷新页面
5. 验证仍为深色模式
```

**预期结果**：
- 主题切换流畅
- 所有颜色适配良好
- 主题持久化

### 6. 权限测试

#### 6.1 游客权限
- [ ] 可以浏览文章列表
- [ ] 可以阅读文章详情
- [ ] 不能发表评论（提示登录）
- [ ] 不能创建文章

**测试步骤**：
```
1. 登出账户（游客状态）
2. 访问首页，验证可以浏览
3. 点击文章，验证可以阅读
4. 尝试评论，验证提示登录
5. 验证没有"写文章"按钮
```

**预期结果**：
- 游客只有浏览权限
- 受限功能有明确提示

#### 6.2 普通用户权限
- [ ] 可以创建、编辑、删除自己的文章
- [ ] 不能编辑其他用户的文章
- [ ] 可以发表评论
- [ ] 可以删除自己的评论

**测试步骤**：
```
1. 以普通用户登录
2. 创建文章，验证成功
3. 尝试访问其他用户文章的编辑页面
4. 验证无权限或不显示编辑按钮
```

**预期结果**：
- 只能管理自己的内容

#### 6.3 管理员权限
- [ ] 可以编辑任何文章
- [ ] 可以删除任何文章
- [ ] 可以删除任何评论

**测试步骤**：
```
1. 将用户设为管理员
2. 访问其他用户的文章
3. 验证有编辑和删除按钮
4. 验证可以删除任何评论
```

**预期结果**：
- 管理员有完全权限

### 7. 性能测试

#### 7.1 页面加载速度
- [ ] 首页加载时间 < 2s
- [ ] 文章详情页加载时间 < 1.5s
- [ ] API 响应时间 < 500ms

**测试工具**：
- Chrome DevTools Network 面板
- Lighthouse

**测试步骤**：
```
1. 打开 Chrome DevTools
2. 切换到 Network 面板
3. 刷新页面
4. 查看 Load 时间
5. 运行 Lighthouse 测试
```

**预期结果**：
- Performance 分数 > 90
- 首次内容绘制 < 1s

#### 7.2 数据库查询性能
- [ ] 文章列表查询 < 100ms
- [ ] 全文搜索 < 200ms
- [ ] 评论加载 < 50ms

**测试方法**：
- 查看 Workers 日志
- 使用 wrangler tail

### 8. 错误处理测试

#### 8.1 网络错误
- [ ] 断网情况下显示友好错误
- [ ] API 超时有提示

#### 8.2 数据验证
- [ ] 空标题不能创建文章
- [ ] 空内容不能创建文章
- [ ] 空评论不能提交

**测试步骤**：
```
1. 尝试提交空标题的文章
2. 验证显示错误提示
3. 尝试提交空评论
4. 验证显示错误提示
```

**预期结果**：
- 所有验证正确
- 错误提示清晰

#### 8.3 权限错误
- [ ] 未登录访问受限页面跳转登录
- [ ] 无权限操作显示错误

### 9. 数据一致性测试

#### 9.1 文章计数
- [ ] 浏览次数正确递增
- [ ] 评论数量准确

#### 9.2 关联数据
- [ ] 删除文章时级联删除评论
- [ ] 分类和标签关联正确

**测试步骤**：
```
1. 创建文章并添加评论
2. 删除文章
3. 验证评论也被删除（数据库查询）
```

### 10. 安全测试

#### 10.1 XSS 防护
- [ ] 在评论中输入 `<script>alert('XSS')</script>`
- [ ] 验证被转义，不执行

#### 10.2 SQL 注入防护
- [ ] 在搜索框输入 `' OR '1'='1`
- [ ] 验证不会导致错误或数据泄露

#### 10.3 CSRF 防护
- [ ] 验证敏感操作有适当保护

## 测试报告模板

### 测试执行记录

| 测试项 | 状态 | 备注 | 测试人 | 测试时间 |
|--------|------|------|--------|---------|
| 用户注册 | ⬜ 通过 / ⬜ 失败 | | | |
| 用户登录 | ⬜ 通过 / ⬜ 失败 | | | |
| 创建文章 | ⬜ 通过 / ⬜ 失败 | | | |
| 编辑文章 | ⬜ 通过 / ⬜ 失败 | | | |
| 删除文章 | ⬜ 通过 / ⬜ 失败 | | | |
| 发表评论 | ⬜ 通过 / ⬜ 失败 | | | |
| 全文搜索 | ⬜ 通过 / ⬜ 失败 | | | |
| 分类筛选 | ⬜ 通过 / ⬜ 失败 | | | |
| 标签筛选 | ⬜ 通过 / ⬜ 失败 | | | |
| 响应式设计 | ⬜ 通过 / ⬜ 失败 | | | |
| 深色模式 | ⬜ 通过 / ⬜ 失败 | | | |
| 权限控制 | ⬜ 通过 / ⬜ 失败 | | | |

### 发现的问题

| 问题ID | 严重程度 | 问题描述 | 复现步骤 | 状态 |
|--------|----------|----------|----------|------|
| BUG-001 | 高/中/低 | 描述 | 步骤 | 待修复/已修复 |

### 性能指标

| 指标 | 目标值 | 实际值 | 状态 |
|------|--------|--------|------|
| 首页加载时间 | < 2s | | |
| API 响应时间 | < 500ms | | |
| Lighthouse 分数 | > 90 | | |

## 自动化测试（建议）

### 未来可添加的自动化测试

1. **单元测试**
   - API 函数测试
   - 工具函数测试

2. **集成测试**
   - API 端点测试
   - 数据库操作测试

3. **E2E 测试**
   - Playwright/Cypress
   - 用户流程自动化

## 测试环境准备

### 测试数据准备

```sql
-- 创建测试用户
INSERT INTO users (email, password_hash, username, display_name, role) 
VALUES ('admin@test.com', 'hash', 'admin', 'Admin User', 'admin');

INSERT INTO users (email, password_hash, username, display_name, role) 
VALUES ('user@test.com', 'hash', 'testuser', 'Test User', 'user');

-- 创建测试文章
INSERT INTO posts (title, slug, content, excerpt, author_id, status, published_at)
VALUES ('测试文章1', 'test-post-1', '这是测试内容', '测试摘要', 1, 'published', CURRENT_TIMESTAMP);
```

## 测试完成标准

- [ ] 所有核心功能测试通过
- [ ] 无严重 Bug
- [ ] 性能指标达标
- [ ] 安全测试通过
- [ ] 在至少3种浏览器测试（Chrome, Firefox, Safari）
- [ ] 在至少3种设备尺寸测试（桌面、平板、手机）
